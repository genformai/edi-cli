# Basic validation rules for EDI 270/271 Eligibility Inquiry/Response transactions
# These rules validate fundamental structure and data integrity

rules:
  - name: "require_information_source"
    description: "Ensure information source (payer) is present"
    severity: "error"
    transaction_types: ["270", "271"]
    category: "structural"
    error_code: "270_271_MISSING_PAYER"
    message: "270/271 transaction must contain information source (payer) information"
    conditions:
      - field: "information_source"
        operator: "not_exists"

  - name: "require_information_receiver"
    description: "Ensure information receiver (provider) is present"
    severity: "error"
    transaction_types: ["270", "271"]
    category: "structural"
    error_code: "270_271_MISSING_PROVIDER"
    message: "270/271 transaction must contain information receiver (provider) information"
    conditions:
      - field: "information_receiver"
        operator: "not_exists"

  - name: "require_subscriber"
    description: "Ensure subscriber information is present"
    severity: "error"
    transaction_types: ["270", "271"]
    category: "structural"
    error_code: "270_271_MISSING_SUBSCRIBER"
    message: "270/271 transaction must contain subscriber information"
    conditions:
      - field: "subscriber"
        operator: "not_exists"

  - name: "require_payer_name"
    description: "Ensure payer name is present and not empty"
    severity: "error"
    transaction_types: ["270", "271"]
    category: "data"
    error_code: "270_271_MISSING_PAYER_NAME"
    message: "Information source (payer) name is required"
    conditions:
      - field: "information_source.name"
        operator: "eq"
        value: ""

  - name: "require_provider_name"
    description: "Ensure provider name is present and not empty"
    severity: "error"
    transaction_types: ["270", "271"]
    category: "data"
    error_code: "270_271_MISSING_PROVIDER_NAME"
    message: "Information receiver (provider) name is required"
    conditions:
      - field: "information_receiver.name"
        operator: "eq"
        value: ""

  - name: "require_provider_npi"
    description: "Ensure provider NPI is present and not empty"
    severity: "error"
    transaction_types: ["270", "271"]
    category: "data"
    error_code: "270_271_MISSING_PROVIDER_NPI"
    message: "Provider NPI is required"
    conditions:
      - field: "information_receiver.npi"
        operator: "eq"
        value: ""

  - name: "require_member_id"
    description: "Ensure subscriber member ID is present and not empty"
    severity: "error"
    transaction_types: ["270", "271"]
    category: "data"
    error_code: "270_271_MISSING_MEMBER_ID"
    message: "Subscriber member ID is required"
    conditions:
      - field: "subscriber.member_id"
        operator: "eq"
        value: ""

  - name: "require_subscriber_last_name"
    description: "Ensure subscriber last name is present and not empty"
    severity: "error"
    transaction_types: ["270", "271"]
    category: "data"
    error_code: "270_271_MISSING_SUBSCRIBER_NAME"
    message: "Subscriber last name is required"
    conditions:
      - field: "subscriber.last_name"
        operator: "eq"
        value: ""

  - name: "require_270_inquiries"
    description: "270 transaction must have eligibility inquiries"
    severity: "error"
    transaction_types: ["270"]
    category: "business"
    error_code: "270_MISSING_INQUIRIES"
    message: "270 transaction must contain at least one eligibility inquiry"
    conditions:
      - field: "eligibility_inquiries"
        operator: "not_exists"

  - name: "validate_provider_npi_format"
    description: "Provider NPI should be 10 digits"
    severity: "warning"
    transaction_types: ["270", "271"]
    category: "data"
    error_code: "270_271_INVALID_NPI_FORMAT"
    message: "Provider NPI should be exactly 10 digits"
    conditions:
      - field: "information_receiver.npi"
        operator: "not_matches"
        value: "^\\d{10}$"

  - name: "validate_gender_code"
    description: "Gender code should be valid"
    severity: "warning"
    transaction_types: ["270", "271"]
    category: "data"
    error_code: "270_271_INVALID_GENDER"
    message: "Gender code should be M (Male), F (Female), or U (Unknown)"
    conditions:
      - field: "subscriber.gender"
        operator: "not_in"
        value: ["M", "F", "U"]