# Basic validation rules for EDI 835 Healthcare Claim Payment/Advice
# These rules validate fundamental structure and data integrity
# Rules trigger errors when the condition evaluates to TRUE

rules:
  - name: "require_financial_information"
    description: "Ensure BPR segment with financial information is present"
    severity: "error"
    transaction_types: ["835"]
    category: "structural"
    error_code: "835_MISSING_BPR"
    message: "835 transaction must contain BPR (financial information) segment"
    conditions:
      - field: "financial_information"
        operator: "not_exists"

  - name: "require_payer_information"
    description: "Ensure payer information is present"
    severity: "error"
    transaction_types: ["835"]
    category: "structural"
    error_code: "835_MISSING_PAYER"
    message: "835 transaction must contain payer information"
    conditions:
      - field: "payer"
        operator: "not_exists"

  - name: "require_payee_information"
    description: "Ensure payee information is present"
    severity: "warning"
    transaction_types: ["835"]
    category: "structural"
    error_code: "835_MISSING_PAYEE"
    message: "835 transaction should contain payee information"
    conditions:
      - field: "payee"
        operator: "not_exists"

  - name: "validate_total_paid_positive"
    description: "Total paid amount should be non-negative"
    severity: "error"
    transaction_types: ["835"]
    category: "data"
    error_code: "835_NEGATIVE_TOTAL_PAID"
    message: "Total paid amount cannot be negative"
    conditions:
      - field: "financial_information.total_paid"
        operator: "lt"
        value: 0

  - name: "validate_payment_method"
    description: "Payment method must be a valid code"
    severity: "warning"
    transaction_types: ["835"]
    category: "data"
    error_code: "835_INVALID_PAYMENT_METHOD"
    message: "Payment method must be ACH, CHK, FWT, or BOP"
    conditions:
      - field: "financial_information.payment_method"
        operator: "not_in"
        value: ["ACH", "CHK", "FWT", "BOP"]

  - name: "require_claims"
    description: "835 transaction should contain at least one claim"
    severity: "warning"
    transaction_types: ["835"]
    category: "business"
    error_code: "835_NO_CLAIMS"
    message: "835 transaction should contain at least one claim (CLP segment)"
    conditions:
      - field: "claims"
        operator: "not_exists"

  - name: "validate_claim_id_present"
    description: "Each claim must have a claim ID"
    severity: "error"
    transaction_types: ["835"]
    category: "data"
    error_code: "835_MISSING_CLAIM_ID"
    message: "Claim must have a claim ID"
    conditions:
      - field: "claims[0].claim_id"
        operator: "not_exists"

  - name: "validate_claim_charge_positive"
    description: "Claim charge amount should be non-negative"
    severity: "error"
    transaction_types: ["835"]
    category: "data"
    error_code: "835_NEGATIVE_CLAIM_CHARGE"
    message: "Claim charge amount cannot be negative"
    conditions:
      - field: "claims[0].total_charge"
        operator: "lt"
        value: 0

  - name: "validate_claim_paid_positive"
    description: "Claim paid amount should be non-negative"
    severity: "error"
    transaction_types: ["835"]
    category: "data"
    error_code: "835_NEGATIVE_CLAIM_PAID"
    message: "Claim paid amount cannot be negative"
    conditions:
      - field: "claims[0].total_paid"
        operator: "lt"
        value: 0

  - name: "validate_patient_responsibility_positive"
    description: "Patient responsibility amount should be non-negative"
    severity: "error"
    transaction_types: ["835"]
    category: "data"
    error_code: "835_NEGATIVE_PATIENT_RESP"
    message: "Patient responsibility amount cannot be negative"
    conditions:
      - field: "claims[0].patient_responsibility"
        operator: "lt"
        value: 0

  - name: "validate_claim_status_code"
    description: "Claim status code must be valid"
    severity: "warning"
    transaction_types: ["835"]
    category: "data"
    error_code: "835_INVALID_CLAIM_STATUS"
    message: "Invalid claim status code"
    conditions:
      - field: "claims[0].status_code"
        operator: "not_in"
        value: ["1", "2", "3", "4", "5", "19", "20", "21", "22", "23"]

  - name: "validate_service_codes_present"
    description: "Service lines should have procedure codes"
    severity: "warning"
    transaction_types: ["835"]
    category: "data"
    error_code: "835_MISSING_SERVICE_CODE"
    message: "Service line should have a procedure code"
    enabled: false  # Disabled by default as not all claims have services
    conditions:
      - field: "claims[0].services[0].service_code"
        operator: "not_exists"